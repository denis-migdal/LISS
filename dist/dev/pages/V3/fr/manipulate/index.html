<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf8"/>
        <title>LISS</title>
        <meta name="color-scheme" content="dark light">
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link   href="./index.css"  rel="stylesheet" blocking="render">
        <script  src="./index.js"  type="module"     blocking="render" async></script>
    </head>
    <body code-langs="js,bry">
        <main>

<h1 id="manipuler-un-composant-web">Manipuler un composant Web</h1>
<h2 id="cr√©er-une-instance-dun-composant-web">Cr√©er une instance d&#39;un composant Web</h2>
<h3 id="via-son-constructeur">Via son constructeur</h3>
<p>Il est possible de construire une instance du composant Web (donc d√©j√† mis √† niveau) via son constructeur. Cependant, il convient de s&#39;assurer que :</p>
<ul>
<li>le constructeur puisse √™tre appel√© sans arguments ;</li>
<li>le composant Web est bien d√©fini.</li>
</ul>
<p>Pour cela, plusieurs fonctions sont utiles :</p>
<script type="c-js">
// LISS
LISS.isDefined(<h>$TAGNAME_OR_KLASS</h>);
LISS.whenDefined(<h>$TAGNAME_OR_KLASS</h>);

// vanilla
customElements.getName(<h>$KLASS</h>);       // si non-d√©fini, retourne null.
customElements.get(<h>$TAGNAME</h>);         // si non-d√©fini, retourne undefined.

customElements.whenDefined(<h>$TAGNAME</h>); // retourne une promesse. 
</script>

<h3 id="via-createelementtagname">Via <script type="c-js">createElement(<h>$TAGNAME</h>)</script></h3>
<p>Les √©l√©ments HTML sont usuellement cr√©√©s via <script type="c-js">document.createElement(<h>$TAGNAME</h>)</script>. Cependant, cela est source d&#39;erreurs pour les composants Web :</p>
<ul>
<li>l&#39;√©l√©ment cr√©√© est potentiellement imm√©diatement mis √† niveau, emp√™chant de lui ajouter des attributs ou des fils.</li>
<li>une exception est lanc√©e si le constructeur modifie les attributs, ou le contenu de l&#39;h√¥te.</li>
</ul>
<p>Il convient alors d&#39;utiliser <script type="c-js">LISS.createElement(<h>$TAGNAME</h>)</script> afin de cr√©er un √©l√©ment HTML sans le mettre √† niveau imm√©diatement. Il est ainsi possible de lui ajouter des attributs et des fils avant sa mise √† niveau.</p>
<h3 id="via-une-cha√Æne-de-caract√®res">Via une cha√Æne de caract√®res</h3>
<p>Il est aussi possible de cr√©er des √©l√©ments HTML via une cha√Æne de caract√®res :</p>
<script type="c-js">
LISS.html`<h>$HTML</h>`;
</script>

<p>üí° Si le r√©sulat a vocation a √™tre clon√©, il est possible d&#39;utiliser <script type="c-js">LISS.template`<h>$HTML</h>`</script> √† la place.</p>
<h2 id="interagir-avec-un-composant-web">Interagir avec un composant Web</h2>
<p>Comme vu dans la partie conception, il est n√©cessaire d&#39;interragir avec les composant Web comme s&#39;ils n&#39;avaient pas encore √©t√© mis √† niveau, i.e. comme un <script type="c-html">HTMLElement</script>. Cependant, il existe quelques astuces pour aller plus loin.</p>
<h3 id="setter">Setter</h3>
<p>Il est possible de fixer la valeur d&#39;une propri√©t√© avant la mise √† niveau du composant Web. Il sera alors n√©cessaire, dans le constructeur, de r√©cup√©rer cette valeur avant de la supprimer :</p>
<script type="c-js">
class Klass extends HTMLElement {
    constructor() {
        super();
        
        let v = LISS.getInitialValue(this, "prop");
    }

    set prop(value) {
        /* ... */
    }
}
</script>

<h3 id="appels-de-m√©thodes">Appels de m√©thodes</h3>
<h4 id="asynchrone">Asynchrone</h4>
<p>Les appels de m√©thodes asynchrones sont les plus simples √† g√©rer. Il suffit en effet d&#39;appeler une function asynchrone qui prend en entr√©e le composant Web, attende qu&#39;il se mette √† niveau, puis appelle la m√©thode d√©sir√©e :</p>
<script type="c-js">
async function call(instance, method, ...args) {
    await ??;
    return instance[method](...args);
}
</script>

<p>‚ö† Il est cependant recommand√© d&#39;√©viter cela autant que possible.</p>
<h4 id="synchrone">Synchrone</h4>
<p>Pour un appel de m√©thode synchrone, il convient de forcer la mise √† niveau du composant Web. En cas d&#39;√©chec de la mise √† niveau (e.g. pas encore d√©fini), lancer une exception.</p>
<p>‚ö† L&#39;appel synchrone pouvant √©chou√©, il est recommand√© d&#39;√©viter d&#39;utiliser cette m√©thode autant que possible.</p>
<h4 id="getter">Getter</h4>
<p>Comme un appel de m√©thode, ou...
Pour un getter, la technique est un peu plus compliqu√©e.</p>
</main>
    </body>
</html>